# Bes2 핵심 분석 로직 및 기능 정의서 (v1.4 - The Precise Logic)

**Date:** 2025-11-30
**Status:** Architecture Finalized & Logic Synchronized
**Updated by:** User & AI Assistant

---

## 1. Bes2의 핵심 4대 기능 (The Big 4)

리포트(현황판)와 꿀팁(정보)을 제외한, 사용자가 실제로 사진을 정리하는 **핵심 액션 기능 4가지**입니다.

### ① 추억 소환 (Memory Recall)
*   **유형:** UI 카드
*   **목적:** **"과거의 특별한 날 재발견"**.
*   **대상:** 1년 전 오늘 등 사진이 많이 찍힌 특정 이벤트 날짜.
*   **동작:** 해당 날짜의 사진만 격리하여 보여주고 정리 유도.
*   **DB:** 본채(`review_items`) / `source_type = 'MEMORY'`.

### ② 갤러리 다이어트 (Gallery Diet)
*   **유형:** UI 카드
*   **목적:** **"과거 사진 스캔 및 정리"** (조금씩 꾸준히).
*   **대상:** 앱 실행 시점 기준 과거의 일반 사진들.
*   **동작:** 
    *   최근 사진부터 30장씩 역순 스캔.
    *   **쓰레기통(50장)과 독립적**으로 목표치(30장)를 채울 때까지 스캔.
    *   발견 즉시 숫자 카운트, 분석 완료 후 정리 화면 진입.
*   **DB:** 본채(`review_items`) / `source_type = 'DIET'`.

### ③ 스크린샷 정리 (Trash Cleaning)
*   **유형:** UI 카드
*   **목적:** **"쓰레기통 비우기"**.
*   **대상:** 스크린샷, 문서, **사물(Object)** 등 '버릴 사진'.
*   **동작:** 
    *   스캔 중 발견된 비(非)사진을 즉시 분류.
    *   별도의 정밀 분석 없이 빠르게 삭제 처리.
*   **DB:** 별채(`trash_items`) / `status = 'READY'`.

### ④ 분류된 사진 정리하기 (Instant Review)
*   **유형:** 하단 메인 버튼 (파란 테두리)
*   **목적:** **"방금 찍은 사진 즉시 정리"** (앱 사용 중 촬영분).
*   **대상:** **앱 시작(감지 서비스 실행) 시점 이후**에 촬영된 모든 사진.
*   **기준점:** `MediaDetectionService` 시작 시 저장된 `APP_START_TIME`.
*   **동작:** 
    *   실시간 촬영 감지 -> **1분 후** 분석 시작 -> 알림/버튼 활성화.
    *   사용자가 미처 정리하지 못하고 앱에 들어왔을 때, "하던 일 마저 하라"는 의미.
*   **DB:** 본채(`review_items`) / `source_type = 'INSTANT'`.

---

## 2. 시스템 아키텍처 및 통일성 (Uniformity)

### 🖥️ 1. UI 구조: 단일 페이지 전략 (One Page, Multiple Views)
정상 사진을 정리하는 **1번, 2번, 4번 기능**은 모두 **하나의 공통 UI (`ReviewScreen`)**를 사용합니다.
*   **진입 시점:** 사용자가 누른 버튼에 따라 `source_type` (`MEMORY`, `DIET`, `INSTANT`) 인자가 전달됩니다.
*   **데이터 로딩:** `ReviewViewModel`이 `source_type`에 맞는 데이터만 DB에서 필터링하여 보여줍니다.
*   **장점:** 어떤 경로로 들어오든 **사용자는 동일하고 일관된 정리 경험(Swipe UI)**을 하게 됩니다.

### ⚙️ 2. 분석 파이프라인: 단일 엔진 전략 (Unified Engine)
사진이 수집되는 경로(Worker)는 달라도, **분석 및 처리 로직은 완벽하게 동일**합니다.
*   **입구 (Dispatcher):** `PhotoDiscoveryWorker` (Instant/Diet) 또는 `MemoryEventWorker` (Memory)가 사진을 수집하여 `ReviewItemEntity` 테이블에 넣습니다.
*   **공정 (Process):**
    *   **정밀 분석:** `PhotoAnalysisWorker`가 테이블의 모든 `NEW` 사진을 처리합니다. 출처(`source_type`)와 관계없이 **동일한 AI 기준(NIMA, Blur, Eye)**이 적용됩니다.
    *   **그룹화:** `ClusteringWorker`가 **동일한 `ImageClusteringHelper`**를 사용하여 묶음을 만듭니다.
*   **결과:** 모든 정상 사진은 **균일한 품질 기준**으로 분석되고 관리됩니다.

---

## 3. 데이터베이스 및 처리 흐름 (The Pipeline)

### 🧱 데이터의 이원화 (DB 분리)
*   **본채 (`ReviewItemEntity`):** 소중한 사진용 (추억, 다이어트, 분류된 정리).
    *   **카운팅:** 3가지 소스(추억/다이어트/촬영) 통합 카운팅 -> 30장(추후 100장)마다 광고.
*   **별채 (`TrashItemEntity`):** 쓰레기 사진용 (스크린샷 정리).
    *   **카운팅:** 독자적 카운팅 -> 30장(추후 100장)마다 광고.

---

## 4. UI 동작 원리 (UX Logic)

*   **다이어트 버튼:** `DIET` 소스의 사진이 발견되면 즉시 숫자 표시. (반응성 최우선)
*   **쓰레기통 버튼:** `READY` 상태의 쓰레기 사진 카운트.
*   **분류된 정리 버튼:** `INSTANT` 소스의 **분석 완료된(Clustered)** 사진이 있을 때만 활성화. (완료된 업무 처리)
*   **추억 버튼:** `MEMORY` 소스의 이벤트가 있을 때만 노출.

---

## 5. 참고 사항
*   **리포트(현황판):** 단순 정보 표시용 (서류).
*   **꿀팁:** AI 활용 정보 제공 (서류).
